
---

# Clickjacking básico con token CSRF

## Introducción

En este laboratorio exploramos cómo un atacante puede inducir a un usuario legítimo a realizar una acción sensible —como eliminar su cuenta— utilizando técnicas de clickjacking, incluso aunque dicha acción esté protegida por un token CSRF. La clave es que el sitio vulnerable no implementa encabezados que impidan ser incrustado dentro de un iframe.

[Ver laboratorio Portswigger](https://portswigger.net/web-security/clickjacking/lab-basic-csrf-protected)

## Contexto

El sitio objetivo ofrece funcionalidad de inicio de sesión y un botón de "Delete account" protegido por un token CSRF. Aunque el token evita envíos forzados de peticiones, no protege frente a interacciones involuntarias provocadas visualmente. Si la aplicación permite ser cargada en un iframe, un atacante puede superponer elementos señuelo para que el usuario "crea" estar clicando en un contenido inocuo cuando en realidad está pulsando el botón destructivo.

## Análisis de la técnica

El ataque se basa en:

- Incrustar la página **/my-account-account** dentro de un iframe.
    
- Reducir drásticamente la opacidad del iframe (casi transparente).
    
- Posicionar el iframe para que su botón "Delete account" quede justo debajo de un elemento señuelo con la palabra "Click" o "Click me".
    
- Ajustar manualmente las coordenadas y dimensiones del iframe y del elemento señuelo para que el engaño sea perfecto.
    

Cuando la víctima pulsa el botón visible del señuelo, en realidad presiona el botón invisible de "Delete account" dentro del iframe, completando así el ataque.

## Explotación

A partir del exploit server, la estructura HTML que permite resolver el laboratorio es la siguiente:

```html
<style>
iframe {
    width: 1500px;
    height: 740px;
    opacity: 0.001;
}

div {
    position: absolute;
    top: 535px;
    left: 215px;
}
</style>
<div>Click</div>
<iframe src="https://YOUR-LAB-ID.web-security-academy.net/my-account"></iframe>
```

### Ajustes clave

- Sustituir **YOUR-LAB-ID** por el identificador del laboratorio.
    
- Ajustar `width` y `height` para abarcar el área donde se encuentra el botón.
    
- Ajustar `top` y `left` del elemento señuelo hasta que quede exactamente encima del botón de "Delete account".
    
- Mantener el iframe con una opacidad muy baja para que sea totalmente imperceptible en la versión final del ataque.
    

## Verificación previa

Con la opacidad algo mayor (por ejemplo, 0.1) se comprueba la alineación:

- Mover el ratón por encima del texto señuelo.
    
- Verificar que el cursor cambia indicando que realmente se está apuntando al botón del iframe.
    
- Repetir ajustes de posición hasta lograr alineación perfecta.
    

Es importante **no pulsar manualmente** el botón de "Delete account" durante el ajuste, ya que esto rompería el laboratorio.

## Publicación del ataque

Cuando todo está alineado:

1. Sustituimos "Click" por "Click me".
    
2. Almacenamos la versión final.
    
3. Entregamos el exploit a la víctima.
    
4. Una vez la víctima hace clic, la cuenta se elimina y el laboratorio queda resuelto.
    

## Conclusión

Este ejercicio demuestra que los tokens CSRF protegen contra solicitudes forzadas, pero **no** contra interacciones visuales engañosas. Sin encabezados como `X-Frame-Options` o políticas `frame-ancestors` en Content-Security-Policy, la aplicación queda expuesta a este tipo de manipulación.

El laboratorio pone de relieve la importancia de implementar defensa en profundidad: además de proteger acciones críticas con tokens, es esencial controlar en qué contextos puede representarse la interfaz para evitar interacciones inducidas.

---
