
---

# Clickjacking con datos precargados por parámetro

## Introducción

En este laboratorio analizamos una variante de clickjacking en la que el atacante puede **precargar datos en el formulario** víctima mediante parámetros en la URL. Nuestro objetivo es comprender cómo una interfaz vulnerable permite que un usuario termine realizando una acción crítica sin darse cuenta, incluso cuando el backend no presenta fallos aparentes.

[Ver laboratorio Portswigger](https://portswigger.net/web-security/clickjacking/lab-prefilled-form-input)

## ¿En qué consiste esta vulnerabilidad?

El ataque se basa en dos características combinadas:

1. La aplicación permite ser cargada dentro de un **iframe** porque no implementa cabeceras de protección como `X-Frame-Options` o `Content-Security-Policy`.
    
2. El formulario de cambio de correo **acepta parámetros GET**, como `?email=valor`, para precargar automáticamente el campo.
    

Si combinamos esto con una superposición visual, logramos que el usuario pulse un botón señuelo mientras en realidad está pulsando el botón **Update email** del iframe oculto.

## ¿Cómo ocurre el ataque?

1. El usuario está autenticado en la web vulnerable.
    
2. Visitamos nuestro exploit, que contiene un iframe prácticamente invisible.
    
3. La URL del iframe incluye un parámetro como `?email=pwned@pwned.com`, precargando el formulario.
    
4. Colocamos un señuelo visual encima del botón real.
    
5. Cuando el usuario hace clic, envía el formulario del iframe, cambiando su correo sin saberlo.
    

La acción se completa porque el formulario es legítimo y el servidor confía en los datos precargados desde la URL.

## Payload utilizado

A continuación incluimos exactamente el payload del laboratorio, tal como lo hemos utilizado:

```html
<style> 
iframe {
    width: 1500px;
    height: 740px;
    opacity: 0.001;
}

div {
    position: absolute;
    top: 490px;
    left: 215px;
}
</style>
<div>Click</div>
<iframe src="https://0a6e001f03ef476e81d094d100b500ef.web-security-academy.net/my-account?email=pwned@pwned.com"></iframe>
```

Con esta estructura:

- El iframe es transparente y ocupa la zona necesaria para cubrir el botón de actualización.
    
- El texto “Click” funciona como señuelo.
    
- El parámetro `?email=pwned@pwned.com` preconfigura el nuevo correo.
    
- El usuario, al hacer clic en el señuelo, envía el formulario que cambia su propio correo.
    

## ¿Por qué es efectivo?

Este ataque funciona incluso si el formulario tiene token CSRF válido, porque:

- No estamos fabricando un POST falso.
    
- No estamos rompiendo el token.
    
- Simplemente hacemos que el usuario pulse el botón legítimo del formulario legítimo.
    

El problema no está en la lógica del backend, sino en la capacidad del atacante de controlar visualmente la interfaz mediante un iframe.

## Riesgos asociados

Este tipo de vulnerabilidad puede permitir:

- Cambiar el correo de un usuario y tomar control de su cuenta.
    
- Enviar formularios sensibles sin interacción consciente.
    
- Manipular otros datos precargables por parámetros.
    

Una interfaz mal protegida puede resultar tan peligrosa como un fallo del backend.

## Mitigaciones recomendadas

Para prevenir este tipo de ataques, la aplicación debería implementar:

- `X-Frame-Options: DENY` o `SAMEORIGIN`.
    
- `Content-Security-Policy: frame-ancestors 'none';`.
    
- Evitar que parámetros GET precarguen datos sensibles.
    
- Confirmaciones de acción adicionales cuando se modifican datos críticos.
    

---
