
---

# Open Redirect basado en el DOM

## Introducción

En este laboratorio analizamos una vulnerabilidad de **open redirection basada en el DOM**, donde una redirección se produce íntegramente en el navegador a partir de datos controlados por el usuario.

El fallo se origina cuando un script JavaScript extrae un parámetro `url` directamente desde `location.href` y lo utiliza como destino de navegación sin aplicar ningún tipo de validación. Esto permite redirigir a la víctima a un dominio externo controlado por un atacante.

[Ver laboratorio PortSwigger](https://portswigger.net/web-security/dom-based/open-redirection/lab-dom-open-redirection)

## ¿En qué consiste esta vulnerabilidad?

Una vulnerabilidad de **open redirect** ocurre cuando una aplicación permite que el usuario controle el destino final de una redirección.

En este laboratorio, el problema es de tipo **DOM-based**, ya que:

1. La lógica vulnerable se ejecuta completamente en el navegador.
    
2. El destino de la redirección se obtiene desde la URL actual.
    
3. El valor extraído se asigna directamente a `location.href`.
    
4. No existe ninguna validación del dominio de destino.
    

Esto permite a un atacante construir enlaces que aparentan ser legítimos pero que redirigen a sitios externos.

## Código vulnerable identificado

El enlace vulnerable presente en la página es el siguiente:

```html
<a href="#" onclick="returnUrl = /url=(https?:\/\/.+)/.exec(location); if (returnUrl) location.href = returnUrl[1]; else location.href = '/';">Back to Blog</a>
```

Este código presenta varios problemas de seguridad:

- Usa `location` como fuente de datos sin restricciones.
    
- Permite controlar completamente el parámetro `url`.
    
- No valida si el dominio es interno o confiable.
    
- Asigna directamente el valor a `location.href`.
    

## Análisis de la expresión regular

La expresión regular utilizada es:

```javascript
/url=(https?:\/\/.+)/
```

Su funcionamiento es el siguiente:

- Busca la cadena `url=` dentro de la URL actual.
    
- Acepta cualquier valor que comience por `http://` o `https://`.
    
- Captura todo lo que venga a continuación.
    

Esto implica que **cualquier dominio externo es aceptado**, siempre que use HTTP o HTTPS.

## ¿Cómo se resuelve el laboratorio?

Para explotar la vulnerabilidad seguimos estos pasos:

1. Construimos una URL hacia la página vulnerable.
    
2. Incluimos el parámetro `url` con el dominio del exploit server.
    
3. La víctima accede a la URL manipulada.
    
4. Al hacer clic en el enlace "Back to Blog", se ejecuta el script JavaScript.
    
5. El valor del parámetro `url` se extrae mediante la expresión regular.
    
6. El navegador redirige automáticamente al dominio del atacante.
    

## URL utilizada

La URL utilizada para resolver el laboratorio tiene la siguiente estructura:

```
https://YOUR-LAB-ID.web-security-academy.net/post?postId=4&url=https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/
```

El parámetro `url` controla completamente el destino final de la redirección.

## ¿Por qué funciona el ataque?

El ataque funciona porque:

- El navegador confía en el JavaScript de la aplicación.
    
- No existe ninguna restricción sobre el destino permitido.
    
- `location.href` acepta cualquier URL absoluta.
    
- La validación mediante expresión regular es insuficiente.
    

No se rompe ninguna política de seguridad del navegador; el comportamiento es el esperado desde su punto de vista.

## Riesgos asociados

Una vulnerabilidad de open redirect puede permitir:

- Ataques de phishing más creíbles.
    
- Encadenamiento con XSS u OAuth.
    
- Redirecciones a sitios maliciosos.
    
- Abuso de la confianza del dominio legítimo.
    

Aunque no implica ejecución directa de código, su impacto puede ser significativo.

## Mitigaciones recomendadas

Para prevenir este tipo de vulnerabilidades se recomienda:

- Evitar redirecciones basadas en URLs controlables por el usuario.
    
- Permitir solo rutas internas en lugar de URLs completas.
    
- Implementar listas blancas estrictas de destinos.
    
- Realizar las redirecciones en el servidor cuando sea posible.
    

Este laboratorio demuestra que incluso una lógica aparentemente simple puede convertirse en un vector de ataque si se confía ciegamente en datos del DOM.

---
